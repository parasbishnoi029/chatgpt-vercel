<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BrainAura</title>
<style>
body { background:#0f0f1a;color:#fff;font-family:Arial }
.chat { height:70vh; overflow:auto }
.bubble { padding:8px;margin:6px;border-radius:8px }
.user { background:#6a5cff;text-align:right }
.ai { background:#222 }
</style>
</head>
<body>

<h2>BrainAura</h2>

<div id="login">
  <input id="email" placeholder="Enter email">
  <button onclick="login()">Continue</button>
</div>

<div id="app" style="display:none;">
  <p id="user"></p>
  <button onclick="logout()">Logout</button>
  <div id="chat" class="chat"></div>
  <textarea id="msg"></textarea>
  <button onclick="send()">Send</button>
  <button onclick="clearChat()">Clear</button>
</div>

<p style="font-size:12px;">Made by <b>Paras Bishnoi</b></p>

<script>
const chat = document.getElementById("chat");
const msg = document.getElementById("msg");

if (localStorage.token) showApp();

async function login() {
  const email = document.getElementById("email").value;
  const res = await fetch("/api/login", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ email })
  });
  const data = await res.json();
  localStorage.token = data.token;
  localStorage.email = data.email;
  showApp();
}

function showApp() {
  document.getElementById("login").style.display="none";
  document.getElementById("app").style.display="block";
  document.getElementById("user").innerText = localStorage.email;
  loadHistory();
}

function logout() {
  localStorage.clear();
  location.reload();
}

function addBubble(text, cls) {
  const d=document.createElement("div");
  d.className="bubble "+cls;
  d.innerText=text;
  chat.appendChild(d);
}

async function loadHistory() {
  const res = await fetch("/api/history", {
    headers:{ Authorization:"Bearer "+localStorage.token }
  });
  const data = await res.json();
  chat.innerHTML="";
  data.forEach(m=>addBubble(m.content,m.role==="user"?"user":"ai"));
}

async function send() {
  const text = msg.value.trim();
  addBubble(text,"user");
  msg.value="";
  const res = await fetch("/api/chat",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      Authorization:"Bearer "+localStorage.token
    },
    body:JSON.stringify({ message:text })
  });
  const data = await res.json();
  addBubble(data.reply,"ai");
}

function clearChat(){
  chat.innerHTML="";
}
</script>
</body>
</html>
